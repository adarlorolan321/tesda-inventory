import{s as $,q as v,k as m,p as g,O as d,J as y}from"./app-458c2b36.js";import{l as x}from"./lodash-51beffbf.js";import{t as f}from"./toastr-66696e6d.js";function D(S={},n,c=null){const a=$(S),i=v("create"),h=m(()=>y().props.data),t=m(()=>y().props.params),l=v(!1),u=v(null),e=v({perPage:50,query:null,page:1});g(()=>{t.value&&(t.value.page&&(e.value.page=t.value.page),t.value.perPage&&(e.value.perPage=t.value.perPage),t.value.query&&(e.value.query=t.value.query),t.value.sort&&(e.value.sort=t.value.sort),t.value.order&&(e.value.order=t.value.order),t.value.role&&(e.value.role=t.value.role))}),g(()=>{var r=document.getElementById("offCanvasForm");r&&(u.value=new bootstrap.Offcanvas(r))});const p=()=>{u.value&&u.value.hide()},b=()=>{u.value&&u.value.toggle()},C=(r,o)=>{(r=="perPage"||r=="query")&&(e.value.page=1),r=="sort"?e.value.sort&&e.value.sort==o?e.value.order=="asc"?(e.value.sort=o,e.value.order="desc"):(e.value.sort=null,e.value.order=null):(e.value.sort=o,e.value.order="asc"):e.value[r]=o,P()},P=x.debounce(()=>{let r=route(`${n}.index`,e.value);c&&(r=route(c.routeName,{id:c.routeId}));let o={};for(const s in e.value)e.value[s]&&e.value[s]!=""&&(o[s]=e.value[s]);d.get(r,o,{preserveState:!0,preventScroll:!0,only:["data","params"]})},500),O=async()=>{a.clearErrors(),a.post(route(`${n}.store`),{preserveState:!0,preventScroll:!0,only:["data","params","errors"],onSuccess:()=>{f.success("Record saved"),a.reset(),p()}})},E=async()=>{a.clearErrors(),a.patch(route(`${n}.update`,a.id),{preserveState:!0,preventScroll:!0,only:["data","params","errors"],onSuccess:()=>{f.info("Record updated"),a.reset(),p()}})},q=async r=>{console.log(c),Swal.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-danger"}}).then(o=>{o.isConfirmed&&d.delete(route(`${n}.destroy`,r),{preserveState:!0,preventScroll:!0,only:["data","params"],onSuccess:()=>{f.error("Record deleted")}})})},w=()=>{T(),d.reload([]),l.value=!1,setTimeout(()=>{l.value=!0},1e3),i.value="create"},B=r=>{r=JSON.parse(JSON.stringify(r)),a.reset(),a.clearErrors();for(const o in r){const s=r[o];a[o]=s}i.value="update",b(),l.value=!1,setTimeout(()=>{l.value=!0},1e3)},T=()=>{a.reset(),a.clearErrors()};return{paginatedData:h,isLoadingComponents:l,form:a,createPromise:O,updatePromise:E,deletePromise:q,handleCreate:w,handleEdit:B,serverQuery:e,handleServerQuery:C,formState:i}}export{D as u};
