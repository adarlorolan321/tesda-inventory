import{s as x,q as i,k as y,p as g,O as v,J as S}from"./app-5faf48b2.js";import{l as $}from"./lodash-1fd6b89a.js";import{t as p}from"./toastr-e642026e.js";function D(h={},c,f=null,s=null){const t=x(h),d=i("create"),b=y(()=>S().props.data),r=y(()=>S().props.params),u=i(!1),n=i(null),e=i({perPage:50,query:null,page:1});g(()=>{r.value&&(r.value.page&&(e.value.page=r.value.page),r.value.perPage&&(e.value.perPage=r.value.perPage),r.value.query&&(e.value.query=r.value.query),r.value.sort&&(e.value.sort=r.value.sort),r.value.order&&(e.value.order=r.value.order),r.value.role&&(e.value.role=r.value.role),r.value.coach_filter&&(e.value.coach_filter=r.value.coach_filter),r.value.service_filter&&(e.value.service_filter=r.value.service_filter))}),g(()=>{var a=document.getElementById("offCanvasForm");a&&(n.value=new bootstrap.Offcanvas(a))});const m=()=>{n.value&&n.value.hide()},C=()=>{n.value&&n.value.toggle()},P=(a,o)=>{(a=="perPage"||a=="query")&&(e.value.page=1),a=="sort"?e.value.sort&&e.value.sort==o?e.value.order=="asc"?(e.value.sort=o,e.value.order="desc"):(e.value.sort=null,e.value.order=null):(e.value.sort=o,e.value.order="asc"):e.value[a]=o,O()},O=$.debounce(()=>{let a=route(`${c}.index`,e.value);f&&(a=route(f.routeName,{id:f.routeId}));let o={};for(const l in e.value)e.value[l]&&e.value[l]!=""&&(o[l]=e.value[l]);v.get(a,o,{preserveState:!0,preventScroll:!0,only:["data","params"]})},500),E=async()=>{t.clearErrors(),t.post(route(`${c}.store`),{preserveState:!0,preventScroll:!0,only:["data","params","errors"],onSuccess:()=>{p.success("Record saved"),s?(t.reset(),v.visit(route(s.redirectTo,s.id))):m()}})},q=async()=>{t.clearErrors(),t.patch(route(`${c}.update`,t.id),{preserveState:!0,preventScroll:!0,only:["data","params","errors","auth"],onSuccess:()=>{p.info("Record updated"),s?v.visit(route(s.redirectTo,s.id)):(t.reset(),m())}})},w=async a=>{Swal.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-danger"}}).then(o=>{o.isConfirmed&&v.delete(route(`${c}.destroy`,a),{preserveState:!0,preventScroll:!0,only:["data","params"],onSuccess:()=>{p.error("Record deleted")}})})},B=()=>{_(),v.reload([]),u.value=!1,setTimeout(()=>{u.value=!0},1e3),d.value="create"},T=a=>{a=JSON.parse(JSON.stringify(a)),t.reset(),t.clearErrors();for(const o in a){const l=a[o];t[o]=l}d.value="update",C(),u.value=!1,setTimeout(()=>{u.value=!0},1e3)},_=()=>{t.reset(),t.clearErrors()};return{paginatedData:b,isLoadingComponents:u,form:t,createPromise:E,updatePromise:q,deletePromise:w,handleCreate:B,handleEdit:T,serverQuery:e,handleServerQuery:P,formState:d}}export{D as u};
